import{u as fe,r as s,G as be,j as e,S as ye,x as J}from"./app-aef64c69.js";import{M as ve}from"./MainLayout-e41de4fa.js";function Ne({general:u,headerMenu:K,footerMenu4:X,footerMenu3:B,footerMenu2:H,categoryMenu:Q,auth:n,carts:b,district:U,pixelData:a,pixelData2:l}){var q,z,O,$,F,A,L,R,Y;const{cart:c,initializeCart:g}=fe(),[k,V]=s.useState([]);s.useState("");const[h,W]=s.useState(((q=n==null?void 0:n.user)==null?void 0:q.district)||null),[j,Z]=s.useState(((z=n==null?void 0:n.user)==null?void 0:z.city)||null),[_,I]=s.useState("Cash on delivery"),[D,S]=s.useState(!1),[ge,y]=s.useState(""),[p,x]=s.useState(!1),[ee,te]=s.useState(""),[se,ce]=s.useState(""),[w,re]=s.useState(""),[ne,oe]=s.useState(""),[C,ie]=s.useState(""),[E,ae]=s.useState(""),[N,v]=s.useState(""),[M,le]=s.useState(""),[T,de]=s.useState(""),[P,ue]=s.useState(""),he=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),{data:ke,setData:m,post:Se,processing:_e,errors:we}=be({name:((O=n.user)==null?void 0:O.name)||"",mobile:(($=n.user)==null?void 0:$.mobile)||"",email:((F=n.user)==null?void 0:F.email)||"",address:((A=n.user)==null?void 0:A.address_line1)||"",district:((L=n==null?void 0:n.user)==null?void 0:L.district)||null,city:((R=n==null?void 0:n.user)==null?void 0:R.city)||null,payment_option:""});s.useEffect(()=>{m("district",h)},[h,m]),s.useEffect(()=>{m("city",j)},[j,m]),s.useEffect(()=>{a&&(typeof fbq<"u"?fbq("track",a.event_name,{...a.custom_data,...a.user_data,event_id:a.event_id,event_time:a.event_time,event_source_url:a.event_source_url,action_source:a.action_source},{eventID:a.event_id}):console.warn("fbq not defined — check that Pixel script is loaded."))},[a]),s.useEffect(()=>{l&&(typeof fbq<"u"?fbq("track",l.event_name,{...l.custom_data,...l.user_data,event_id:l.event_id,event_time:l.event_time,event_source_url:l.event_source_url,action_source:l.action_source},{eventID:l.event_id}):console.warn("fbq not defined — check that Pixel script is loaded."))},[l]);const pe=t=>{/^[0-9]{11}$/.test(t)?(v(""),x(!0)):(v("Mobile number must be exactly 11 digits."),x(!1))},me=async t=>{t.preventDefault();const o={name:ee,mobile:w,email:se,address:ne,district:h,city:j,payment_option:_};console.log(o);try{S(!0);const i=await fetch("/checkout",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":he},body:JSON.stringify(o)}),r=await i.json();i.ok?(y(r.message),x(r.success)):r.errors?(ie(r.errors.name),ae(r.errors.email),v(r.errors.mobile),le(r.errors.address),de(r.errors.district),ue(r.errors.city),y(Object.values(r.errors).flat().join(", ")),x(r.success)):(y(r.message),x(r.success)),r.data?window.location.href=r.data:console.error("Payment initialization failed",r),S(!1)}catch(i){console.error("Error:",i)}console.log("ovder submited")};s.useEffect(()=>{g(b)},[b]),s.useEffect(()=>{(async()=>{if(h)try{const o=await fetch(`/checkout?district_id=${h}`);if(!o.ok)throw new Error(`Failed to fetch thanas: ${o.statusText}`);const i=await o.json();V(i.datas),i.carts&&g(i.carts)}catch(o){console.error("Error fetching thanas:",o)}})()},[h]);const xe=t=>{W(t.target.value)},je=t=>{Z(t.target.value)},f=t=>{I(t.target.value)};return s.useEffect(()=>{m("payment_option",_)},[_,m]),s.useEffect(()=>{var i,r;const t=d=>d.variants&&d.variants.length>0?d.variants.map(G=>`${G.title}:${G.value}`).join(","):null,o=(i=c==null?void 0:c.cartItems)==null?void 0:i.map(d=>({item_id:d.productId,item_name:d.productName,index:d.index||0,item_category:null,item_variant:t(d),price:parseInt(d.subTotal.match(/\d+[\d,.]*/)[0].replace(/,/g,"")),quantity:d.quantity}));window.dataLayer=window.dataLayer||[],window.dataLayer.push({event:"begin_checkout",currency:u.currency,value:c.cartTotalPrice,coupon:(r=c==null?void 0:c.myCoupon)==null?void 0:r.name,items:o}),console.log("checkout  data layer call")},[]),e.jsx(e.Fragment,{children:e.jsxs(ve,{auth:n,general:u,headerMenu:K,footerMenu4:X,footerMenu3:B,categoryMenu:Q,carts:b,footerMenu2:H,children:[e.jsxs(ye,{title:`Checkout - ${u.web_title}`,children:[e.jsx("meta",{name:"title",property:"og:title",content:`Checkout - ${u.web_title}`}),e.jsx("meta",{name:"description",property:"og:description",content:u.meta_description}),e.jsx("meta",{name:"keyword",property:"og:keyword",content:u.meta_keyword}),e.jsx("meta",{name:"image",property:"og:image",content:u.logo_url}),e.jsx("meta",{name:"url",property:"og:url",content:route("checkout")}),e.jsx("link",{rel:"canonical",href:route("checkout")})]}),e.jsx("div",{class:"checkout__page--area",children:e.jsx("div",{class:"container",children:e.jsx("form",{onSubmit:me,children:e.jsxs("div",{class:"checkout__page--inner d-flex",children:[e.jsx("div",{class:"main checkout__mian",children:e.jsxs("main",{class:"main__content_wrappe",children:[e.jsxs("div",{class:"checkout__content--step section__contact--information",children:[e.jsx("div",{class:"section__header checkout__section--header d-flex align-items-center justify-content-between mb-25",children:e.jsx("h2",{class:"section__header--title h3",children:"Contact information "})}),e.jsxs("div",{class:"row",children:[e.jsx("div",{class:"col-lg-12 mb-12",children:e.jsxs("div",{class:"checkout__input--list ",children:[e.jsx("label",{children:"Your Name *"}),e.jsx("input",{class:"checkout__input--field border-radius-5",placeholder:" Name ",type:"text",onChange:t=>te(t.target.value)}),p==!0?"":e.jsxs("p",{className:"errrowMsg",style:{fontSize:"14px"},children:[" ",C&&e.jsx("span",{children:C}),"  "]})]})}),e.jsx("div",{class:"col-12 mb-12",children:e.jsxs("div",{class:"checkout__input--list",children:[e.jsx("label",{children:"Your Mobile *"}),e.jsx("input",{className:"checkout__input--field border-radius-5",placeholder:"Mobile",type:"number",value:w,onChange:t=>{const o=t.target.value;re(o),pe(o)}}),p==!0?"":e.jsxs("p",{className:"errrowMsg",style:{fontSize:"14px"},children:[" ",N&&e.jsx("span",{children:N})," "]})]})}),e.jsx("div",{class:"col-12 mb-12",children:e.jsxs("div",{class:"checkout__input--list",children:[e.jsx("label",{children:"Your Email "}),e.jsx("input",{class:"checkout__input--field border-radius-5",placeholder:"Email (optional)",type:"email",onChange:t=>ce(t.target.value)}),p==!0?"":e.jsxs("p",{className:"errrowMsg",style:{fontSize:"14px"},children:[" ",E&&e.jsx("span",{children:E})," "]})]})}),e.jsxs("div",{class:"col-lg-6 mb-12",children:[e.jsx("div",{class:"checkout__input--list checkout__input--select select",children:e.jsxs("select",{class:"form-select checkout__input--select__field border-radius-5",value:h,onChange:xe,children:[e.jsx("option",{value:"",children:"Select District"}),U.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})}),p==!0?"":e.jsxs("p",{className:"errrowMsg",style:{fontSize:"14px"},children:[" ",T&&e.jsx("span",{children:T})," "]})]}),e.jsxs("div",{class:"col-lg-6 mb-12",children:[e.jsx("div",{class:"checkout__input--list checkout__input--select select",children:e.jsxs("select",{class:"form-select checkout__input--select__field border-radius-5",disabled:!k.length,"aria-label":"Default select example",value:j,onChange:je,children:[e.jsx("option",{value:"",children:"Select Thana"}),k.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})}),p==!0?"":e.jsxs("p",{className:"errrowMsg",style:{fontSize:"14px"},children:[" ",P&&e.jsx("span",{children:P})," "]})]}),e.jsx("div",{class:"col-12 mb-12",children:e.jsxs("div",{class:"checkout__input--list",children:[e.jsx("label",{children:"Address * "}),e.jsx("textarea",{class:"checkout__input--field border-radius-5",rows:"6",style:{height:"unset"},placeholder:"Your Address",type:"text",onChange:t=>oe(t.target.value)}),p==!0?"":e.jsxs("p",{className:"errrowMsg",style:{fontSize:"14px"},children:[" ",M&&e.jsx("span",{children:M}),"  "]})]})})]})]}),e.jsx("br",{}),e.jsx("h3",{class:"section__header--title mb-4",children:"Select Payment Method "}),e.jsxs("div",{class:"newPaymentMethod",children:[e.jsxs("label",{children:[e.jsx("input",{type:"radio",name:"payment_option",value:"Cash on delivery",checked:_==="Cash on delivery",onChange:f}),e.jsx("span",{children:"Cash on delivery "})]}),e.jsxs("label",{children:[e.jsx("input",{type:"radio",name:"payment_option",value:"bkash",checked:_==="bkash",onChange:f}),e.jsx("span",{children:"bkash"})]}),e.jsxs("label",{children:[e.jsx("input",{type:"radio",name:"payment_option",value:"Nogad",checked:_==="Nogad",onChange:f}),e.jsx("span",{children:"Nogad"})]}),e.jsxs("label",{children:[e.jsx("input",{type:"radio",name:"payment_option",value:"online",checked:_==="online",onChange:f}),e.jsx("span",{children:"Online getway"})]})]})]})}),e.jsxs("aside",{class:"checkout__sidebar sidebar",children:[e.jsx("div",{class:"cart__table checkout__product--table",children:e.jsx("table",{class:"cart__table--inner",children:e.jsx("tbody",{class:"cart__table--body",children:(Y=c==null?void 0:c.cartItems)==null?void 0:Y.map(t=>{var o;return e.jsxs("tr",{class:"cart__table--body__items",children:[e.jsx("td",{class:"cart__table--body__list",children:e.jsxs("div",{class:"product__image two  d-flex align-items-center",children:[e.jsxs("div",{class:"product__thumbnail border-radius-5",children:[e.jsx(J,{href:route("carts"),children:e.jsx("img",{class:"border-radius-5",src:t.productImage,alt:"cart-product"})}),e.jsx("span",{class:"product__thumbnail--quantity",children:t.quantity})]}),e.jsxs("div",{class:"product__description",children:[e.jsx("h3",{class:"product__description--name h4",children:e.jsx(J,{href:route("carts"),children:t.productName.length>25?`${t.productName.slice(0,25)}...`:t.productName})}),(o=t==null?void 0:t.variants)==null?void 0:o.map(i=>e.jsxs("span",{class:"cart__content--variant",children:[" ",i.title,": ",i.value," "]}))]})]})}),e.jsx("td",{class:"cart__table--body__list",children:e.jsx("span",{class:"cart__price",children:t.finalPrice})})]})})})})}),e.jsx("div",{class:"checkout__total",children:e.jsxs("table",{class:"checkout__total--table",children:[e.jsxs("tbody",{class:"checkout__total--body",children:[e.jsxs("tr",{class:"checkout__total--items",children:[e.jsx("td",{class:"checkout__total--title text-left",children:"Subtotal  "}),e.jsx("td",{class:"checkout__total--amount text-right",children:c==null?void 0:c.cartTotalPriceFormat})]}),e.jsxs("tr",{class:"checkout__total--items",children:[e.jsx("td",{class:"checkout__total--title text-left",children:"Discount  "}),e.jsx("td",{class:"checkout__total--amount text-right",children:c==null?void 0:c.couponDiscFormat})]}),e.jsxs("tr",{class:"checkout__total--items",children:[e.jsx("td",{class:"checkout__total--title text-left",children:" Shipping Charge "}),e.jsx("td",{class:"checkout__total--amount text-right",children:c.shippingChargeFormat})]})]}),e.jsx("tfoot",{class:"checkout__total--footer",children:e.jsxs("tr",{class:"checkout__total--footer__items",children:[e.jsx("td",{class:"checkout__total--footer__title checkout__total--footer__list text-left",children:"Total  "}),e.jsxs("td",{class:"checkout__total--footer__amount checkout__total--footer__list text-right",children:[c==null?void 0:c.grandTotalFormat," "]})]})})]})}),e.jsxs("button",{type:"submit",disabled:_e,class:"continue__shipping--btn primary__btn border-radius-5 mt-4 d-block w-full text-center",children:[" ",D?e.jsx("div",{class:"spinner-border ",role:"status"}):"Place Order"]})]})]})})})})]})})}export{Ne as default};
